
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Voyage - Litu estonie</title>
  <style>
    :root { --primary: #1a73e8; --bg-sidebar: #ffffff; }
    body { margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Arial, sans-serif; display: flex; height: 100vh; height: 100dvh; overflow: hidden; color: #333; }
    #sidebar { width: 400px; background: var(--bg-sidebar); height: 100%; display: flex; flex-direction: column; box-shadow: 4px 0 15px rgba(0,0,0,0.08); z-index: 10; transition: 0.3s ease; }
    #map { flex: 1; height: 100%; position: relative; }
    
    .sidebar-header { padding: 10px 15px; border-bottom: 1px solid #eee; background: #fff; flex-shrink: 0; }
    .filter-group { display: flex; overflow-x: auto; white-space: nowrap; gap: 8px; padding: 5px 0 10px 0; scrollbar-width: none; }
    .filter-btn { padding: 8px 16px; border: 1px solid #dfe1e5; border-radius: 20px; background: white; cursor: pointer; font-size: 13px; font-weight: 600; }
    .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    .step-nav { display: flex; gap: 8px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
    .step-badge { padding: 6px 12px; border-radius: 15px; font-size: 11px; font-weight: 700; background: #f1f3f4; color: #5f6368; cursor: pointer; white-space: nowrap; border: 1px solid transparent; }
    .step-badge.active { background: #e8f0fe; color: var(--primary); border-color: var(--primary); }

    #poi-content { flex-grow: 1; overflow-y: auto; position: relative; }
    .poi-detail { display: flex; flex-direction: column; min-height: 100%; }
    .close-details { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.6); color: white; border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; z-index: 20; font-size: 20px; }
    .poi-image { width: 100%; height: 230px; object-fit: cover; background: #eee; }
    .poi-body { padding: 20px; flex-grow: 1; }
    .poi-body h2 { margin: 0 0 10px 0; font-size: 20px; line-height: 1.3; }
    
    .badge-container { margin-bottom: 10px; }
    .badge { display: inline-block; background: #f1f3f4; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-right: 5px; }
    .badge-day { background: #e8f0fe; color: var(--primary); }
    
    .btn-group { display: flex; gap: 10px; padding: 15px 20px; background: #fff; border-top: 1px solid #f0f0f0; position: sticky; bottom: 0; }
    .btn { flex: 1; text-align: center; padding: 12px; border-radius: 10px; text-decoration: none; font-weight: 600; font-size: 14px; }
    .btn-main { background: var(--primary); color: white; }
    .btn-outline { border: 1px solid #dadce0; color: #1a73e8; }
    .placeholder { padding: 40px 20px; text-align: center; color: #70757a; font-size: 14px; }

    @media (max-width: 768px) {
      body { flex-direction: column-reverse; }
      #sidebar { width: 100%; max-height: 55%; }
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <div class="sidebar-header">
      <div class="filter-group" id="day-filters">
        <button class="filter-btn active" onclick="filterByDay('all', this)">Toutes</button>
      </div>
    </div>
    <div id="poi-content">
      <div class="placeholder">Sélectionnez une journée pour explorer les étapes.</div>
    </div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>
  <script>
    let map, markerCluster;
    let markersArray = [];
    let initialCenter, initialZoom;
    const locations = [{"lat":59.43696079999999,"lng":24.7535746,"name":"Aéroport de Tallinn, Tallinn","jour":1,"titre":"","type":"aéroport","markerColor":"yellow","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"},{"lat":59.43696079999999,"lng":24.7535746,"name":"Vieille Ville de Tallinn, Tallinn","jour":1,"titre":"","type":"quartier historique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"},{"lat":59.43696079999999,"lng":24.7535746,"name":"Place de l'Hôtel de Ville, Tallinn","jour":2,"titre":"","type":"place","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"},{"lat":55.169438,"lng":23.881275,"name":"Colline de Toompea, Tallinn","jour":2,"titre":"","type":"quartier historique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=55.169438,23.881275&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=55.169438,23.881275"},{"lat":59.4383861,"lng":24.7456299,"name":"Café Maiasmokk, Tallinn","jour":2,"titre":"","type":"café","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.4383861,24.7456299&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.4383861,24.7456299"},{"lat":59.4385036,"lng":24.7909699,"name":"Palais de Kadriorg, Tallinn","jour":3,"titre":"","type":"palais et parc","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.4385036,24.7909699&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.4385036,24.7909699"},{"lat":59.43696079999999,"lng":24.7535746,"name":"Musée d'Art Kumu, Tallinn","jour":3,"titre":"","type":"musée","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"},{"lat":59.43984080000001,"lng":24.7289874,"name":"Telliskivi Creative City, Tallinn","jour":3,"titre":"","type":"quartier créatif","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43984080000001,24.7289874&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43984080000001,24.7289874"},{"lat":59.4401677,"lng":24.7512763,"name":"Kalev Spa, Tallinn","jour":4,"titre":"","type":"spa","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.4401677,24.7512763&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.4401677,24.7512763"},{"lat":59.46826720000001,"lng":24.8341626,"name":"Plage de Pirita, Tallinn","jour":4,"titre":"","type":"plage","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.46826720000001,24.8341626&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.46826720000001,24.8341626"},{"lat":59.43696079999999,"lng":24.7535746,"name":"Gare routière de Tallinn, Tallinn","jour":5,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"},{"lat":58.3916898,"lng":24.4952895,"name":"Gare routière de Pärnu, Pärnu","jour":5,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=58.3916898,24.4952895&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=58.3916898,24.4952895"},{"lat":58.3916898,"lng":24.4952895,"name":"Promenade de Pärnu, Pärnu","jour":5,"titre":"","type":"promenade","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=58.3916898,24.4952895&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=58.3916898,24.4952895"},{"lat":58.37201520000001,"lng":24.5025953,"name":"Plage de Pärnu, Pärnu","jour":6,"titre":"","type":"plage","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=58.37201520000001,24.5025953&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=58.37201520000001,24.5025953"},{"lat":58.3758583,"lng":24.4961821,"name":"Hedon Spa & Hotel, Pärnu","jour":6,"titre":"","type":"spa","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=58.3758583,24.4961821&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=58.3758583,24.4961821"},{"lat":58.3916898,"lng":24.4952895,"name":"Gare routière de Pärnu, Pärnu","jour":7,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=58.3916898,24.4952895&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=58.3916898,24.4952895"},{"lat":56.945034,"lng":24.114516,"name":"Gare routière internationale de Riga, Riga","jour":7,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.945034,24.114516&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.945034,24.114516"},{"lat":56.9676941,"lng":24.1056221,"name":"Vieille Ville de Riga, Riga","jour":7,"titre":"","type":"quartier historique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.9676941,24.1056221&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.9676941,24.1056221"},{"lat":56.9676941,"lng":24.1056221,"name":"Rue Alberta, Riga","jour":8,"titre":"","type":"rue historique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.9676941,24.1056221&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.9676941,24.1056221"},{"lat":56.9438573,"lng":24.1149982,"name":"Marché Central de Riga, Riga","jour":8,"titre":"","type":"marché","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.9438573,24.1149982&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.9438573,24.1149982"},{"lat":56.9490808,"lng":24.104762,"name":"Cathédrale du Dôme de Riga, Riga","jour":8,"titre":"","type":"cathédrale","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.9490808,24.104762&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.9490808,24.104762"},{"lat":56.95089348290409,"lng":24.10902841427046,"name":"Croisière sur le canal de Riga, Riga","jour":9,"titre":"","type":"activité nautique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.95089348290409,24.10902841427046&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.95089348290409,24.10902841427046"},{"lat":56.9519674,"lng":24.1104955,"name":"Parc Bastejkalns, Riga","jour":9,"titre":"","type":"parc","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.9519674,24.1104955&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.9519674,24.1104955"},{"lat":56.945034,"lng":24.114516,"name":"Gare routière internationale de Riga, Riga","jour":10,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.945034,24.114516&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.945034,24.114516"},{"lat":54.6871555,"lng":25.2796514,"name":"Gare routière de Vilnius, Vilnius","jour":10,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6871555,25.2796514&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6871555,25.2796514"},{"lat":54.67830739999999,"lng":25.2864985,"name":"Vieille Ville de Vilnius, Vilnius","jour":10,"titre":"","type":"quartier historique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.67830739999999,25.2864985&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.67830739999999,25.2864985"},{"lat":54.6859253,"lng":25.28777,"name":"Cathédrale de Vilnius, Vilnius","jour":11,"titre":"","type":"cathédrale","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6859253,25.28777&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6859253,25.28777"},{"lat":54.6868341,"lng":25.2906973,"name":"Tour de Gediminas, Vilnius","jour":11,"titre":"","type":"tour","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6868341,25.2906973&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6868341,25.2906973"},{"lat":54.6825757,"lng":25.2876469,"name":"Université de Vilnius, Vilnius","jour":11,"titre":"","type":"université","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6825757,25.2876469&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6825757,25.2876469"},{"lat":54.6807316,"lng":25.2966193,"name":"République d'Užupis, Vilnius","jour":11,"titre":"","type":"quartier artistique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6807316,25.2966193&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6807316,25.2966193"},{"lat":54.65240259999999,"lng":24.933696,"name":"Château de Trakai, Trakai","jour":12,"titre":"","type":"château","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.65240259999999,24.933696&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.65240259999999,24.933696"},{"lat":58.595272,"lng":25.013607,"name":"Lac Galvė, Trakai","jour":12,"titre":"","type":"lac","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=58.595272,25.013607&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=58.595272,25.013607"},{"lat":54.6871555,"lng":25.2796514,"name":"Jardin Botanique de l'Université de Vilnius, Vilnius","jour":13,"titre":"","type":"jardin botanique","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6871555,25.2796514&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6871555,25.2796514"},{"lat":54.6836345,"lng":25.2391386,"name":"Parc Vingis, Vilnius","jour":13,"titre":"","type":"parc","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6836345,25.2391386&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6836345,25.2391386"},{"lat":54.6871555,"lng":25.2796514,"name":"Gare routière de Vilnius, Vilnius","jour":14,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.6871555,25.2796514&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.6871555,25.2796514"},{"lat":54.8985207,"lng":23.9035965,"name":"Gare routière de Kaunas, Kaunas","jour":14,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.8985207,23.9035965&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.8985207,23.9035965"},{"lat":54.8985207,"lng":23.9035965,"name":"Château de Kaunas, Kaunas","jour":14,"titre":"","type":"château","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.8985207,23.9035965&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.8985207,23.9035965"},{"lat":54.8985207,"lng":23.9035965,"name":"Avenue de la Liberté, Kaunas","jour":15,"titre":"","type":"rue commerçante","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.8985207,23.9035965&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.8985207,23.9035965"},{"lat":54.8985207,"lng":23.9035965,"name":"Musée National d'Art M. K. Čiurlionis, Kaunas","jour":15,"titre":"","type":"musée","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.8985207,23.9035965&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.8985207,23.9035965"},{"lat":54.8762859,"lng":24.0222781,"name":"Monastère de Pažaislis, Kaunas","jour":15,"titre":"","type":"monastère","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.8762859,24.0222781&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.8762859,24.0222781"},{"lat":54.8985207,"lng":23.9035965,"name":"Gare routière de Kaunas, Kaunas","jour":16,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=54.8985207,23.9035965&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=54.8985207,23.9035965"},{"lat":56.945034,"lng":24.114516,"name":"Gare routière internationale de Riga, Riga","jour":16,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.945034,24.114516&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.945034,24.114516"},{"lat":56.945034,"lng":24.114516,"name":"Gare routière internationale de Riga, Riga","jour":17,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=56.945034,24.114516&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=56.945034,24.114516"},{"lat":59.43696079999999,"lng":24.7535746,"name":"Gare routière de Tallinn, Tallinn","jour":17,"titre":"","type":"gare routière","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"},{"lat":59.4389862,"lng":24.7565591,"name":"Quartier de Rotermann, Tallinn","jour":18,"titre":"","type":"quartier moderne","markerColor":"blue","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.4389862,24.7565591&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.4389862,24.7565591"},{"lat":59.43696079999999,"lng":24.7535746,"name":"Aéroport de Tallinn, Tallinn","jour":19,"titre":"","type":"aéroport","markerColor":"yellow","streetViewUrl":"https://maps.googleapis.com/maps/api/streetview?size=600x400&location=59.43696079999999,24.7535746&key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI","streetViewLinkUrl":"https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=59.43696079999999,24.7535746"}];

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        zoomControl: true,
        streetViewControl: false,
        mapTypeControl: false,
        styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }]
      });

      const days = [...new Set(locations.map(l => l.jour))].sort((a,b) => a - b);
      const filterContainer = document.getElementById('day-filters');
      days.forEach(day => {
        const btn = document.createElement('button');
        btn.className = 'filter-btn';
        btn.innerText = 'Jour ' + day;
        btn.onclick = function() { filterByDay(day, this); };
        filterContainer.appendChild(btn);
      });

      const bounds = new google.maps.LatLngBounds();
      locations.forEach((loc, index) => {
        const marker = new google.maps.Marker({
          position: { lat: loc.lat, lng: loc.lng },
          // URL corrigée pour les icônes
          icon: 'https://maps.google.com/mapfiles/ms/icons/' + loc.markerColor + '-dot.png',
          label: { text: String(loc.jour), color: 'white', fontSize: '11px', fontWeight: 'bold' },
          data: loc
        });
        marker.addListener('click', () => updateSidebar(loc));
        markersArray.push(marker);
        bounds.extend(marker.getPosition());
      });

      markerCluster = new markerClusterer.MarkerClusterer({ map, markers: markersArray });

      if (locations.length > 0) {
        map.fitBounds(bounds);
        google.maps.event.addListenerOnce(map, 'idle', () => {
          if (map.getZoom() > 14) map.setZoom(14);
          initialCenter = map.getCenter();
          initialZoom = map.getZoom();
        });
      }
    }

    function updateSidebar(poi) {
      const container = document.getElementById('poi-content');
      const daySteps = locations.filter(l => l.jour === poi.jour);
      let stepHtml = '';
      
      if (daySteps.length > 1) {
        stepHtml = '<div class="step-nav">';
        daySteps.forEach((step, idx) => {
          const active = (step.name === poi.name && step.lat === poi.lat) ? 'active' : '';
          const locIdx = locations.findIndex(l => l === step);
          stepHtml += `<div class="step-badge ${active}" onclick="updateSidebarByIndex(${locIdx})">Étape ${idx + 1}</div>`;
        });
        stepHtml += '</div>';
      }

      container.innerHTML = `
        <div class="poi-detail">
          <button class="close-details" onclick="closeSidebar()">✕</button>
          <img src="${poi.streetViewUrl}" class="poi-image" onerror="this.style.display='none'">
          <div class="poi-body">
            ${stepHtml}
            <div class="badge-container">
              <span class="badge badge-day">Jour ${poi.jour}</span>
              <span class="badge">${poi.type}</span>
            </div>
            <h2>${poi.name}</h2>
            <p>${poi.titre}</p>
          </div>
          <div class="btn-group">
            <a href="https://www.google.com/maps/dir/?api=1&destination=${poi.lat},${poi.lng}" target="_blank" class="btn btn-main">Itinéraire</a>
            <a href="${poi.streetViewLinkUrl}" target="_blank" class="btn btn-outline">Street View</a>
          </div>
        </div>
      `;
      
      // Déplacement et zoom unique ici
      map.panTo({ lat: poi.lat, lng: poi.lng });
      map.setZoom(14);
      container.scrollTop = 0;
    }

    window.updateSidebarByIndex = function(index) {
      updateSidebar(locations[index]);
    };

    function filterByDay(day, btn) {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      const filteredMarkers = day === 'all' ? markersArray : markersArray.filter(m => m.data.jour === day);
      markerCluster.clearMarkers();
      markerCluster.addMarkers(filteredMarkers);

      if (day === 'all') {
        map.setCenter(initialCenter);
        map.setZoom(initialZoom);
        closeSidebar();
      } else if (filteredMarkers.length > 0) {
        // Appelle la sidebar pour le premier point, qui gère aussi le panTo/zoom
        updateSidebar(filteredMarkers[0].data);
      }
    }

    function closeSidebar() {
      document.getElementById('poi-content').innerHTML = '<div class="placeholder">Sélectionnez une journée pour explorer les étapes.</div>';
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB5WUNvRC9eOjHRLt92fs4hsp0Auje3aAI&callback=initMap"></script>
</body>
</html>
